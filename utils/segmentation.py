import json

import numpy as np

LOWER_HIPS_VERTICES = [
    3439,
    3440,
    3441,
    3442,
    3447,
    3448,
    3454,
    3455,
    3462,
    3463,
    3464,
    3465,
    3466,
    3467,
    3468,
    3469,
    3470,
    3471,
    3472,
    3473,
    3492,
    3493,
    3494,
    3495,
    3496,
    3497,
    3498,
    3499,
    3500,
    3510,
    3511,
    3512,
    3513,
    3514,
    3515,
    3542,
    3543,
    3562,
    3567,
    3734,
    3735,
    3840,
    3841,
    3842,
    3843,
    3884,
    3885,
    3902,
    3903,
    3916,
    3958,
    3971,
    3972,
    3993,
    4002,
    4065,
    4066,
    4080,
    4081,
    4084,
    4088,
    4130,
    4144,
    4145,
    4320,
    4321,
    4406,
    4407,
    4408,
    4409,
    4412,
    4413,
    4415,
    4417,
    4418,
    4419,
    4420,
    4421,
    4422,
    4423,
    4424,
    4425,
    5557,
    5574,
    5575,
    5596,
    5600,
    5601,
    5603,
    5604,
    5613,
    5614,
    5658,
    5659,
    5660,
    5661,
    5662,
    5663,
    5664,
    5665,
    5666,
    5667,
    5668,
    5669,
    5670,
    5671,
    5672,
    5673,
    5674,
    5675,
    5676,
    5678,
    5680,
    5681,
    5682,
    5683,
    5684,
    5685,
    5686,
    5687,
    5688,
    5689,
    5690,
    5691,
    5692,
    5693,
    5694,
    5695,
    5696,
    5703,
    5704,
    5705,
    5711,
    5712,
    5713,
    5714,
    5715,
    5716,
    5717,
    5718,
    5719,
    5931,
    5934,
    5949,
    6200,
    6201,
    6202,
    6203,
    6208,
    6209,
    6215,
    6216,
    6223,
    6224,
    6225,
    6226,
    6227,
    6228,
    6229,
    6230,
    6231,
    6232,
    6233,
    6234,
    6253,
    6254,
    6255,
    6256,
    6257,
    6258,
    6259,
    6260,
    6261,
    6271,
    6272,
    6273,
    6274,
    6275,
    6276,
    6303,
    6304,
    6323,
    6328,
    6557,
    6595,
    6596,
    6597,
    6598,
    6634,
    6635,
    6650,
    6651,
    6664,
    6706,
    6719,
    6720,
    6734,
    6741,
    6742,
    6824,
    6825,
    6828,
    6832,
    6874,
    6888,
    6889,
    7142,
    7143,
    7144,
    7145,
    7148,
    7149,
    7151,
    7153,
    7154,
    7155,
    7156,
    7157,
    7158,
    7159,
    7160,
    7161,
    8352,
    8353,
    8354,
    8355,
    8356,
    8357,
    8358,
    8359,
    8360,
    8361,
    8362,
    8363,
    8364,
    8365,
    8366,
    8367,
    8368,
    8369,
    8370,
    8372,
    8374,
    8375,
    8376,
    8377,
    8378,
    8379,
    8380,
    8381,
    8382,
    8383,
    8384,
    8385,
    8386,
    8387,
    8388,
    8389,
    8390,
    8397,
    8398,
    8399,
    8405,
    8406,
    8407,
    8408,
    8409,
    8410,
    8411,
    8412,
    8413,
]
BODY_COLOR = [0.91, 0.80, 0.61]
LEGS_COLOR = [0.41, 0.35, 0.25]
TORSO_COLOR = [0.6, 0.74, 0.9]


def body_to_vertex_colors(part_segmentation, vertices, alpha=1.0):
    vertex_colors = np.ones((vertices, 4))
    vertex_colors[:, :] = [BODY_COLOR[0], BODY_COLOR[1], BODY_COLOR[2], alpha]

    for part_name, vertex_index in part_segmentation.items():
        try:
            if part_name not in [
                "spine",
                "spine1",
                "spine2",
                "leftShoulder",
                "rightShoulder",
                "leftUpLeg",
                "rightUpLeg",
                "rightLeg",
                "leftLeg",
                "hips",
            ]:
                continue

            elif part_name in ["hips", "leftUpLeg", "rightUpLeg", "rightLeg", "leftLeg"]:
                vertex_colors[vertex_index, :3] = LEGS_COLOR

            else:
                vertex_colors[vertex_index, :3] = TORSO_COLOR
        except IndexError:
            pass

    return vertex_colors


def smpl_body_segmentation():
    smpl_segmentation_file_path = "additional/smpl/smpl_vert_segmentation.json"
    try:
        with open(
            smpl_segmentation_file_path, "r"
        ) as smpl_segmentation_file_handler:
            smpl_segmentation_data = json.load(smpl_segmentation_file_handler)

            # Lower hips replacement
            smpl_segmentation_data["spine"].extend(
                set(smpl_segmentation_data["hips"]).difference(LOWER_HIPS_VERTICES)
            )
            smpl_segmentation_data["hips"] = LOWER_HIPS_VERTICES

            return smpl_segmentation_data

    except FileNotFoundError:
        print(f"File {smpl_segmentation_file_path} not found.")

    except json.JSONDecodeError:
        print(f"File {smpl_segmentation_file_path} is not a valid JSON file.")

    return None
